"use strict";(()=>{var e={};e.id=558,e.ids=[558],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},9714:e=>{e.exports=require("constants")},84770:e=>{e.exports=require("crypto")},18139:e=>{e.exports=require("dgram")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},95346:e=>{e.exports=require("timers")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6005:e=>{e.exports=require("node:crypto")},15673:e=>{e.exports=require("node:events")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},70612:e=>{e.exports=require("node:os")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},97525:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>D,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>q,staticGenerationAsyncStorage:()=>x});var i={};r.r(i),r.d(i,{GET:()=>d,POST:()=>c,runtime:()=>p});var s=r(49303),n=r(88716),o=r(60670),a=r(87070),u=r(9487);let p="nodejs";async function d(e){let{searchParams:t}=new URL(e.url),r=t.get("createdBy"),i=t.get("riskId"),s=t.get("riskNo"),n=t.get("department"),o=(await (0,u.M)()).request(),p="WHERE 1=1";r&&(o.input("CreatedBy",r),p+=" AND (i.CreatedByUserId = @CreatedBy OR r.CreatedByUserId = @CreatedBy)"),i&&(o.input("RiskId",i),p+=" AND i.RiskId = @RiskId"),s&&(o.input("RiskNo",s),p+=" AND r.RiskNo = @RiskNo"),n&&(o.input("DepName",n),p+=" AND d.Name = @DepName");let d=await o.query(`
    SELECT i.IncidentId, i.RiskId, r.RiskNo,
           i.DepartmentId, d.Name AS Department,
           i.Summary, i.OccurredAtUtc, i.Description, i.MitigationSteps,
           i.CurrentStatusText, i.ClosedDateUtc,
           i.CreatedByUserId, i.CreatedAtUtc, i.UpdatedAtUtc
    FROM dbo.incidents_t i
    JOIN dbo.Risks r ON r.RiskId = i.RiskId
    JOIN dbo.Departments d ON d.DepartmentId = i.DepartmentId
    ${p}
    ORDER BY i.OccurredAtUtc DESC
  `),c=a.NextResponse.json(d.recordset);return c.headers.set("Access-Control-Allow-Origin","*"),c}async function c(e){let t=await e.json(),r=(await (0,u.M)()).request();return r.input("RiskId",t.riskId),r.input("DepartmentId",t.departmentId),r.input("Summary",t.summary||null),r.input("OccurredAtUtc",t.occurredAtUtc),r.input("Description",t.description),r.input("MitigationSteps",t.mitigationSteps||null),r.input("CurrentStatusText",t.currentStatusText||null),r.input("ClosedDateUtc",t.closedDateUtc||null),r.input("CreatedByUserId",t.createdByUserId||null),await r.query(`
    INSERT INTO dbo.incidents_t (
      IncidentId, RiskId, DepartmentId, Summary, OccurredAtUtc, Description,
      MitigationSteps, CurrentStatusText, ClosedDateUtc,
      CreatedByUserId
    )
    VALUES (
      NEWID(), @RiskId, @DepartmentId, @Summary, @OccurredAtUtc, @Description,
      @MitigationSteps, @CurrentStatusText, @ClosedDateUtc,
      @CreatedByUserId
    )
  `),a.NextResponse.json({ok:!0},{status:201})}let l=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/incidents/route",pathname:"/api/incidents",filename:"route",bundlePath:"app/api/incidents/route"},resolvedPagePath:"C:\\Users\\127547.INDIA\\Documents\\enterprise-risk-management-dashboard\\server-next\\app\\api\\incidents\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:q}=l,I="/api/incidents/route";function D(){return(0,o.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:x})}},9487:(e,t,r)=>{r.d(t,{M:()=>a});var i=r(33049),s=r.n(i),n=r(16636);r.n(n)().config({path:".env.local"});let o=null;async function a(){if(o&&o.connected)return o;o&&!o.connected&&await o.close();let e={server:process.env.DB_SERVER||"riskmanage.database.windows.net",database:process.env.DB_NAME||"riskmanagement",user:process.env.DB_USER||"riskmanagement",password:process.env.DB_PASSWORD||"RiskManage@123",port:Number(process.env.DB_PORT)||1433,options:{encrypt:!0,trustServerCertificate:!1},pool:{max:10,min:0,idleTimeoutMillis:3e4}};return o=await new(s()).ConnectionPool(e).connect()}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[542,181,49],()=>r(97525));module.exports=i})();