"use strict";(()=>{var e={};e.id=942,e.ids=[942],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},9714:e=>{e.exports=require("constants")},84770:e=>{e.exports=require("crypto")},18139:e=>{e.exports=require("dgram")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},95346:e=>{e.exports=require("timers")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6005:e=>{e.exports=require("node:crypto")},15673:e=>{e.exports=require("node:events")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},70612:e=>{e.exports=require("node:os")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},83610:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>g,patchFetch:()=>m,requestAsyncStorage:()=>I,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>v});var r={};i.r(r),i.d(r,{DELETE:()=>x,OPTIONS:()=>p,PUT:()=>c,runtime:()=>u});var s=i(49303),o=i(88716),n=i(60670),a=i(87070),d=i(9487);let u="nodejs";function l(e){return e.headers.set("Access-Control-Allow-Origin","*"),e.headers.set("Access-Control-Allow-Headers","Content-Type"),e.headers.set("Access-Control-Allow-Methods","PUT, DELETE, OPTIONS"),e}async function p(){return l(new a.NextResponse(null,{status:204}))}async function c(e,{params:t}){try{let i=t.id;if(!i)return l(a.NextResponse.json({error:"Missing risk id"},{status:400}));let{name:r,description:s,impact:o,likelihood:n,status:u,identification:p,existingControlInPlace:c,planOfAction:x,categoryId:h,changedByUserId:I}=await e.json()||{},v=await (0,d.M)(),f=(await v.request().input("RiskId",i).query(`
      SELECT Name, Description, Impact, Likelihood, Status, Identification, ExistingControlInPlace, PlanOfAction, CategoryId
      FROM dbo.Risks WHERE RiskId = @RiskId
    `)).recordset[0]||{},g=v.request();g.input("RiskId",i),void 0!==r&&g.input("Name",r),void 0!==s&&g.input("Description",s),void 0!==o&&g.input("Impact",o),void 0!==n&&g.input("Likelihood",n),void 0!==u&&g.input("Status",u),void 0!==p&&g.input("Identification",p),void 0!==c&&g.input("ExistingControlInPlace",c),void 0!==x&&g.input("PlanOfAction",x),void 0!==h&&g.input("CategoryId",h);let m=[];if(void 0!==r&&m.push("Name = @Name"),void 0!==s&&m.push("Description = @Description"),void 0!==o&&m.push("Impact = @Impact"),void 0!==n&&m.push("Likelihood = @Likelihood"),void 0!==u&&m.push("Status = @Status"),void 0!==p&&m.push("Identification = @Identification"),void 0!==c&&m.push("ExistingControlInPlace = @ExistingControlInPlace"),void 0!==x&&m.push("PlanOfAction = @PlanOfAction"),void 0!==h&&m.push("CategoryId = @CategoryId"),m.push("UpdatedAtUtc = SYSUTCDATETIME()"),0===m.length)return l(a.NextResponse.json({ok:!0}));let q=`
      UPDATE dbo.Risks
      SET ${m.join(", ")}
      WHERE RiskId = @RiskId
    `;await g.query(q);let k=[];if(void 0!==r&&r!==f.Name&&k.push({field:"Name",oldVal:f.Name,newVal:r}),void 0!==s&&s!==f.Description&&k.push({field:"Description",oldVal:f.Description,newVal:s}),void 0!==o&&o!==f.Impact&&k.push({field:"Impact",oldVal:f.Impact,newVal:o}),void 0!==n&&n!==f.Likelihood&&k.push({field:"Likelihood",oldVal:f.Likelihood,newVal:n}),void 0!==u&&u!==f.Status&&k.push({field:"Status",oldVal:f.Status,newVal:u}),void 0!==p&&p!==f.Identification&&k.push({field:"Identification",oldVal:f.Identification,newVal:p}),void 0!==c&&c!==f.ExistingControlInPlace&&k.push({field:"ExistingControlInPlace",oldVal:f.ExistingControlInPlace,newVal:c}),void 0!==x&&x!==f.PlanOfAction&&k.push({field:"PlanOfAction",oldVal:f.PlanOfAction,newVal:x}),void 0!==h&&h!==f.CategoryId&&k.push({field:"CategoryId",oldVal:f.CategoryId,newVal:h}),k.length){let e=v.request();e.input("RiskId",i),I&&e.input("ChangedByUserId",I);let t=[];k.forEach((i,r)=>{e.input(`Field${r}`,String(i.field)),e.input(`Old${r}`,void 0===i.oldVal||null===i.oldVal?null:String(i.oldVal)),e.input(`New${r}`,void 0===i.newVal||null===i.newVal?null:String(i.newVal)),t.push(`(@RiskId, SYSUTCDATETIME(), ${I?"@ChangedByUserId":"NULL"}, @Field${r}, @Old${r}, @New${r})`)});let r=`
        INSERT INTO dbo.RiskHistory (RiskId, ChangedAtUtc, ChangedByUserId, FieldName, OldValue, NewValue)
        VALUES ${t.join(",")};
      `;await e.query(r)}return l(a.NextResponse.json({ok:!0}))}catch(e){return l(a.NextResponse.json({error:String(e?.message||e)},{status:500}))}}async function x(e,{params:t}){try{let e=t.id;if(!e)return l(a.NextResponse.json({error:"Missing risk id"},{status:400}));let i=(await (0,d.M)()).request();return i.input("RiskId",e),await i.query("DELETE FROM dbo.incidents_t WHERE RiskId = @RiskId"),await i.query("DELETE FROM dbo.Risks WHERE RiskId = @RiskId"),l(a.NextResponse.json({ok:!0}))}catch(e){return l(a.NextResponse.json({error:String(e?.message||e)},{status:500}))}}let h=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/risks/[id]/route",pathname:"/api/risks/[id]",filename:"route",bundlePath:"app/api/risks/[id]/route"},resolvedPagePath:"C:\\Users\\127547.INDIA\\Documents\\enterprise-risk-management-dashboard\\server-next\\app\\api\\risks\\[id]\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:I,staticGenerationAsyncStorage:v,serverHooks:f}=h,g="/api/risks/[id]/route";function m(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:v})}},9487:(e,t,i)=>{i.d(t,{M:()=>a});var r=i(33049),s=i.n(r),o=i(16636);i.n(o)().config({path:".env.local"});let n=null;async function a(){if(n&&n.connected)return n;n&&!n.connected&&await n.close();let e={server:process.env.DB_SERVER||"riskmanage.database.windows.net",database:process.env.DB_NAME||"riskmanagement",user:process.env.DB_USER||"riskmanagement",password:process.env.DB_PASSWORD||"RiskManage@123",port:Number(process.env.DB_PORT)||1433,options:{encrypt:!0,trustServerCertificate:!1},pool:{max:10,min:0,idleTimeoutMillis:3e4}};return n=await new(s()).ConnectionPool(e).connect()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[542,181,49],()=>i(83610));module.exports=r})();